<!-- layouts/shortcodes/responsive-image.html -->
{{- $src := .Get "src" -}}
{{- $alt := .Get "alt" | default "" -}}
{{- $class := .Get "class" | default "" -}}
{{- $loading := .Get "loading" | default "lazy" -}}

{{- $original := resources.Get (printf "images/%s" $src) -}}
{{- if $original -}}
  {{- $webp := $original.Resize "800x webp q85" -}}
  {{- $large := $original.Resize "800x jpg q85" -}}
  {{- $medium := $original.Resize "600x jpg q85" -}}
  {{- $small := $original.Resize "400x jpg q85" -}}
  
  <picture class="{{ $class }}">
    <!-- WebP sources -->
    <source 
      srcset="{{ ($original.Resize "400x webp q85").RelPermalink }} 400w,
              {{ ($original.Resize "600x webp q85").RelPermalink }} 600w,
              {{ ($original.Resize "800x webp q85").RelPermalink }} 800w"
      sizes="(max-width: 400px) 400px, (max-width: 600px) 600px, 800px"
      type="image/webp">
    
    <!-- Fallback JPEG sources -->
    <source 
      srcset="{{ $small.RelPermalink }} 400w,
              {{ $medium.RelPermalink }} 600w,
              {{ $large.RelPermalink }} 800w"
      sizes="(max-width: 400px) 400px, (max-width: 600px) 600px, 800px"
      type="image/jpeg">
    
    <!-- Fallback img -->
    <img 
      src="{{ $large.RelPermalink }}" 
      alt="{{ $alt }}"
      loading="{{ $loading }}"
      decoding="async"
      class="responsive-image {{ $class }}">
  </picture>
{{- else -}}
  <p class="error">‚ùå Image not found: {{ $src }}</p>
{{- end -}}