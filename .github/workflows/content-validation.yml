name: Content Validation

on: 
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  validate:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup Hugo
        uses: peaceiris/actions-hugo@v2
        with:
          hugo-version: "0.149.0"
          extended: true

      - name: Validate Hugo build
        run: |
          echo "üîç Validating Hugo build..."
          hugo --gc --minify --printPathWarnings
          echo "‚úÖ Hugo build successful"

      - name: Check content structure
        run: |
          echo "üìÅ Checking content structure..."
          
          # Check if content directory exists
          if [ ! -d "content" ]; then
            echo "‚ùå Content directory not found"
            exit 1
          fi
          
          # Check if posts directory exists and has content
          if [ -d "content/posts" ]; then
            POST_COUNT=$(find content/posts -name "*.md" | wc -l)
            echo "üìù Found $POST_COUNT post(s)"
          else
            echo "‚ÑπÔ∏è No posts directory found"
          fi
          
          echo "‚úÖ Content structure validation complete"

      - name: Validate frontmatter
        run: |
          echo "üè∑Ô∏è Validating frontmatter..."
          
          # Only check if posts exist
          if [ -d "content/posts" ] && [ "$(find content/posts -name "*.md" | wc -l)" -gt 0 ]; then
            echo "Checking posts for required frontmatter..."
            
            # Check for titles
            MISSING_TITLES=$(find content/posts -name "*.md" -exec grep -L "^title:" {} \;)
            if [ -n "$MISSING_TITLES" ]; then
              echo "‚ùå Missing titles in:"
              echo "$MISSING_TITLES"
              exit 1
            fi
            
            # Check for dates  
            MISSING_DATES=$(find content/posts -name "*.md" -exec grep -L "^date:" {} \;)
            if [ -n "$MISSING_DATES" ]; then
              echo "‚ùå Missing dates in:"
              echo "$MISSING_DATES"
              exit 1
            fi
            
            echo "‚úÖ All posts have required frontmatter"
          else
            echo "‚ÑπÔ∏è No posts found to validate"
          fi

      - name: Check Hugo configuration
        run: |
          echo "‚öôÔ∏è Validating Hugo configuration..."
          
          if [ -f "hugo.yaml" ]; then
            echo "‚úÖ Found hugo.yaml"
          elif [ -f "hugo.yml" ]; then
            echo "‚úÖ Found hugo.yml"
          elif [ -f "config.yaml" ]; then
            echo "‚úÖ Found config.yaml"
          elif [ -f "config.yml" ]; then
            echo "‚úÖ Found config.yml"
          else
            echo "‚ùå No Hugo configuration file found"
            exit 1
          fi
          
          echo "‚úÖ Configuration validation complete"